name: iOS Build and Test

on:
  push:
    branches:
      - main # Ana dalda çalıştırmak için
  pull_request:
    branches:
      - main # PR sırasında çalıştırma

jobs:
  build:
    name: Build for iOS
    runs-on: macos-latest

    steps:
      # 1. Repository'e erişim ve kodların klonlanması
      - name: Checkout Code
        uses: actions/checkout@v3

      # 2. Xcode kurulumunu doğrula ve CMake gibi araçları kur
      - name: Set Up Dependencies
        run: |
          brew install cmake ninja
          sudo xcode-select --switch /Applications/Xcode.app

      # 3. Derleme klasörü oluştur (build için ayrılmış alan)
      - name: Create Build Directory
        run: mkdir -p build
        working-directory: .

      # 4. CMake yapılandırmasını çalıştır
      - name: Configure CMake
        run: cmake -G Ninja -DCMAKE_SYSTEM_NAME=iOS -DCMAKE_OSX_SYSROOT=iphoneos -DCMAKE_OSX_ARCHITECTURES=arm64 -DCMAKE_OSX_DEPLOYMENT_TARGET=9.0 ..
        working-directory: ./build

      # 5. Ninja ile Derleme yapın
      - name: Build with Ninja
        run: ninja
        working-directory: ./build

      # 6. Derleme sonucu kontrolü (Opsiyonel: libdobby.a veya başka bir çıktı dosyasını kontrol edebilirsiniz)
      - name: Check Build Output
        run: ls ./build