name: Build Dylib

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build dylib
        run: |
          SDK=$(xcrun --sdk iphoneos --show-sdk-path)

          clang++ \
            -dynamiclib \
            -arch arm64 \
            -isysroot $SDK \
            -miphoneos-version-min=12.0 \
            -fobjc-arc \
            -Iinclude \
            Tweak.xm \
            libdobby.a \
            -framework Foundation \
            -lc++ \
            -o tweak.dylib

      - name: Upload dylib
        uses: actions/upload-artifact@v4
        with:
          name: tweak-dylib
          path: tweak.dylib